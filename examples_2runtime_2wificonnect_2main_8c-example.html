<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>objc: examples/runtime/wificonnect/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea"><h1>objc</h1></div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">examples/runtime/wificonnect/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="hw_8h.html">runtime-hw/hw.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sys_8h.html">runtime-sys/sys.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef WIFI_SSID</span></div><div class="line"><span class="preprocessor">#error &quot;WIFI_SSID not defined&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifndef WIFI_PASSWORD</span></div><div class="line"><span class="preprocessor">#error &quot;WIFI_PASSWORD not defined&quot;</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> wifi_callback(hw_wifi_t *wifi, <a class="code" href="group__WiFi.html#ga04c09a1e040ff56c040349a7ad9b6177">hw_wifi_event_t</a> event,</div><div class="line">                          <span class="keyword">const</span> <a name="_a0"></a><a class="code" href="structhw__wifi__network__t.html">hw_wifi_network_t</a> *network, <span class="keywordtype">void</span> *user_data) {</div><div class="line">  (void)user_data;</div><div class="line">  (void)wifi;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a1"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177a866f7bf072f140d677a5a85f8510c7aa">hw_wifi_event_scan</a> &amp;&amp; network) {</div><div class="line">    <a name="a2"></a><a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Scan result\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177a866f7bf072f140d677a5a85f8510c7aa">hw_wifi_event_scan</a> &amp;&amp; network == NULL) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;End of scan\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a3"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177af81b7fb21589631f1bdbda2a8db8082c">hw_wifi_event_joining</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Joining a network\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a4"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177aafa751a65beb159c06faa4ea8137158d">hw_wifi_event_connected</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Connected to a network\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a5"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177ad16e3939fbbf8f1d2eef0563a2112fd8">hw_wifi_event_disconnected</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Disconnected from a network\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a6"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177a4d352b0a5828dc47325f8ffb7340ba53">hw_wifi_event_badauth</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Failed to connect: Bad Auth\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a7"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177ae1a0f2ae833421c90665f1075eeab72c">hw_wifi_event_notfound</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Failed to connect: Network Not Found\n&quot;</span>);</div><div class="line">  }</div><div class="line">  <span class="keywordflow">if</span> (event == <a name="a8"></a><a class="code" href="group__WiFi.html#gga04c09a1e040ff56c040349a7ad9b6177a401f70c76c79b60000c41c30010102b8">hw_wifi_event_error</a>) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Failed to connect: Error\n&quot;</span>);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (network) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;AP: %02X:%02X:%02X:%02X:%02X:%02X SSID=&#39;%s&#39; CH=%u RSSI=%d &quot;</span></div><div class="line">               <span class="stringliteral">&quot;AUTH=0x%02X\n&quot;</span>,</div><div class="line">               network-&gt;<a name="a9"></a><a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[0], network-&gt;<a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[1], network-&gt;<a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[2],</div><div class="line">               network-&gt;<a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[3], network-&gt;<a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[4], network-&gt;<a class="code" href="structhw__wifi__network__t.html#a1ebe0dbbb58937ce4768c8820a51df44">bssid</a>[5],</div><div class="line">               network-&gt;<a name="a10"></a><a class="code" href="structhw__wifi__network__t.html#ac475d8352fc012b95b60e3f08da3fb6b">ssid</a>, (<span class="keywordtype">unsigned</span>)network-&gt;<a name="a11"></a><a class="code" href="structhw__wifi__network__t.html#acec98a2687f6a386616b64f52db3578c">channel</a>, (<span class="keywordtype">int</span>)network-&gt;<a name="a12"></a><a class="code" href="structhw__wifi__network__t.html#adee66bbc82fb8a65fe86de139480fa3c">rssi</a>,</div><div class="line">               (<span class="keywordtype">unsigned</span>)network-&gt;<a name="a13"></a><a class="code" href="structhw__wifi__network__t.html#a1ebd026981430e851a7b2113e2789601">auth</a>);</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  <a name="a14"></a><a class="code" href="group__System.html#gaf411a8bc6b7ed4b0af9114e10c959448">sys_init</a>();</div><div class="line">  <a name="a15"></a><a class="code" href="group__Hardware.html#gae58df14f30461cb37e8607aca5522846">hw_init</a>();</div><div class="line"></div><div class="line">  <span class="comment">// Initialize Wiâ€‘Fi (use default country)</span></div><div class="line">  hw_wifi_t *wifi = <a name="a16"></a><a class="code" href="group__WiFi.html#ga6a186a8bca91c5d0213b177f8cfcb4a0">hw_wifi_init</a>(NULL, wifi_callback, NULL);</div><div class="line">  <span class="keywordflow">if</span> (!<a name="a17"></a><a class="code" href="group__WiFi.html#ga02cf34d87668e0464f65452a5e5a2e90">hw_wifi_valid</a>(wifi)) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;WiFi not available\n&quot;</span>);</div><div class="line">    <span class="keywordflow">goto</span> done;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Start connection</span></div><div class="line">  <a class="code" href="structhw__wifi__network__t.html">hw_wifi_network_t</a> network = {</div><div class="line">      .<a class="code" href="structhw__wifi__network__t.html#ac475d8352fc012b95b60e3f08da3fb6b">ssid</a> = WIFI_SSID,</div><div class="line">  };</div><div class="line"></div><div class="line">  <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Connecting WiFi\n&quot;</span>);</div><div class="line">  <span class="keywordflow">if</span> (!<a name="a18"></a><a class="code" href="group__WiFi.html#ga769d83c1785403dd28982fb3b8df54a3">hw_wifi_connect</a>(wifi, &amp;network, WIFI_PASSWORD)) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Failed to start WiFi connection\n&quot;</span>);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Poll for a short while to let connection happen</span></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 5000; ++i) {</div><div class="line">    <a name="a19"></a><a class="code" href="group__Hardware.html#gacc8f746a8168f505939538614abaa846">hw_poll</a>();</div><div class="line">    <a name="a20"></a><a class="code" href="group__SystemThread.html#gacb5a950a99bad2a938dee8c861e50269">sys_sleep</a>(10);</div><div class="line">  }</div><div class="line"></div><div class="line">  <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Disconnecting WiFi\n&quot;</span>);</div><div class="line">  <span class="keywordflow">if</span> (!<a name="a21"></a><a class="code" href="group__WiFi.html#gabe230d1a31e949c9ba8b9db81399dc8a">hw_wifi_disconnect</a>(wifi)) {</div><div class="line">    <a class="code" href="group__SystemFormatting.html#gab6bda746d6b03c697ebcf468f83fdb6d">sys_printf</a>(<span class="stringliteral">&quot;Failed to disconnect WiFi\n&quot;</span>);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Poll for a short while to let connection happen</span></div><div class="line">  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 1000; ++i) {</div><div class="line">    <a class="code" href="group__Hardware.html#gacc8f746a8168f505939538614abaa846">hw_poll</a>();</div><div class="line">    <a class="code" href="group__SystemThread.html#gacb5a950a99bad2a938dee8c861e50269">sys_sleep</a>(10);</div><div class="line">  }</div><div class="line"></div><div class="line">done:</div><div class="line">  <a name="a22"></a><a class="code" href="group__WiFi.html#ga873a9cac260543ba7005a040857b79ed">hw_wifi_finalize</a>(wifi);</div><div class="line">  <a name="a23"></a><a class="code" href="group__Hardware.html#ga98bf3a5135545d5bf04a564e8a1db808">hw_exit</a>();</div><div class="line">  <a name="a24"></a><a class="code" href="group__System.html#gac8c2364fd51221e5ac983f174aeb289f">sys_exit</a>();</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
