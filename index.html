<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>objc: objc runtime</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="custom.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea"><h1>objc</h1></div>
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">objc runtime </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a minimal Objective C runtime written in C, designed to be portable across different platforms, including ARM and x86 architectures, mostly targeting embedded systems. It uses the "gcc" ABI for the moment, as that is the most portable across different platforms.</p>
<ul>
<li><a href="https://djthorpe.github.io/objc/annotated.html">View the list of all classes</a></li>
<li><a href="https://djthorpe.github.io/objc/files.html">View the list of all files</a></li>
<li><a href="https://djthorpe.github.io/objc/globals_func.html">View the list of all functions</a></li>
</ul>
<h2>Requirements</h2>
<p>You will minimally need the following tools to build the runtime:</p>
<ul>
<li><b>Build system</b> <code>make</code> and <code>cmake</code> - for the build system</li>
<li><b>Compiler</b> <code>clang</code> or <code>gcc</code> - for compiling the runtime (<code>clang</code> is not supported on Apple Silicon). You can use the environment variable <code>CC</code> to specify the compiler, e.g. <code>CC=clang</code> or <code>CC=gcc</code>.</li>
<li><b>Documentation</b> <code>docker</code> is needed for generating the documentation from the source code.</li>
<li><b>Cross-Compilation</b> For cross-compilation for embedded systems based on some ARM variant, get the ARM LLVM toolchain: <a href="https://github.com/ARM-software/LLVM-embedded-toolchain-for-Arm/releases">https://github.com/ARM-software/LLVM-embedded-toolchain-for-Arm/releases</a>. Install this to the <code>/opt</code> directory. You can use the environment variable <code>TOOLCHAIN_PATH</code> to specify the path to the toolchain, e.g. <code>TOOLCHAIN_PATH=/opt/LLVM-ET-Arm-19.1.5-Darwin-universal</code>.</li>
</ul>
<h2>Building the libraries</h2>
<p>Three static libraries are currently built:</p>
<ul>
<li><code>objc-gcc</code> - the Objective C runtime library using the ancient GCC ABI</li>
<li><code>NXFoundation</code> - a minimal set of classes, to support memory management and basic types such as string, array, dictionary, date, time and number.</li>
<li><code>runtime-sys</code> - a minimal set of system functions, needed to bind the runtime to the underlying system, on a per-platform basis.</li>
</ul>
<p>Download the source code from GitHub:</p>
<div class="fragment"><div class="line">git clone git@github.com:djthorpe/objc.git</div><div class="line">cd objc</div></div><!-- fragment --><p>The <code>TOOLCHAIN_PATH</code> environment variable should point to the directory where the toolchain is installed. For Macintosh, you can use Homebrew to install the GCC toolchain, which is required for compiling the runtime on MacOS:</p>
<div class="fragment"><div class="line"># Compile with GCC 15 for MacOS</div><div class="line">brew install gcc@15</div><div class="line">TOOLCHAIN_PATH=/opt/homebrew RELEASE=1 CC=gcc-15 make</div></div><!-- fragment --><p>Once you've made the libraries, use the <code>make tests</code> target to run the unit tests. There is information about test coverage in the tests directory.</p>
<p>You can target different architectures by setting the <code>TARGET</code> environment variable. For a RP2040-based board, you can use the <code>clang</code> compiler with the ARM toolchain. The <code>TARGET</code> environment variable should be set to the target architecture, such as <code>armv6m-none-eabi</code> for the RP2040 Pico board:</p>
<div class="fragment"><div class="line"># Compile for the RP2040 Pico board</div><div class="line">CC=clang TARGET=armv6m-none-eabi TOOLCHAIN_PATH=/opt/LLVM-ET-Arm-19.1.5-Darwin-universal RELEASE=1 make </div></div><!-- fragment --><p>See the list of supported targets in the <a href="https://github.com/djthorpe/objc/tree/main/cmake">cmake</a> directory. You can exclude the environment variable <code>RELEASE=1</code> to build debugging versions of the libraries.</p>
<h2>Installing the libraries</h2>
<p>TODO: the libraries should be installed under a prefix path:</p>
<div class="fragment"><div class="line">PREFIX=/opt/objc make install</div></div><!-- fragment --><ul>
<li>/opt/objc/lib/armv6m-none-eabi/libobjc-gcc.a</li>
<li>/opt/objc/lib/armv6m-none-eabi/libruntime-sys.a</li>
<li>/opt/objc/lib/armv6m-none-eabi/libFoundation.a</li>
<li>/opt/objc/include/objc</li>
<li>/opt/objc/include/sys</li>
<li>/opt/objc/include/NXFoundation</li>
<li>/opt/objc/doc/...</li>
</ul>
<p>These can subsequently be used to make your executables!</p>
<h2>Documentation</h2>
<p>To build the API documentation, you will need to have <code>docker</code> installed. The documentation is built using <code>doxygen</code> through <code>docker</code> so you don't need to have it installed directly.</p>
<div class="fragment"><div class="line">make docs</div><div class="line">open docs/index.html </div></div><!-- fragment --><p>The documentation is also published <a href="https://djthorpe.github.io/objc/">here</a>.</p>
<h2>Current status</h2>
<ul>
<li>[X] Registering classes</li>
<li>[X] Simple message calling</li>
<li>[X] <code><a class="el" href="interfaceNXConstantString.html" title="A constant string class. ">NXConstantString</a></code></li>
<li>[X] Resolving super classes and meta classes for message lookup</li>
<li>[X] Calling methods in super classes - implement <code>[super init]</code> for example</li>
<li>[X] Calling methods in categories</li>
<li>[X] Memory management - alloc, dealloc, memory arenas - require malloc in an <code><a class="el" href="interfaceNXZone.html" title="A class for managing memory zones. ">NXZone</a></code></li>
<li>[X] Printf support - <code>vsprintf</code> - printf-like function which can be used by NXLog, <a class="el" href="interfaceNXString.html" title="A class for managing and manipulating string objects. ">NXString</a> and sys_panicf</li>
<li>[X] Memory management - retain, release - reference counting for objects through <a class="el" href="interfaceNXZone.html" title="A class for managing memory zones. ">NXZone</a></li>
<li>[X] Date and Time - <code><a class="el" href="interfaceNXDate.html" title="A class for representing and manipulating dates. ">NXDate</a></code> - mutable date and time</li>
<li>[X] <code><a class="el" href="interfaceNXNumber.html" title="The base class for NXNumber instances. ">NXNumber</a></code> with booleans</li>
<li>[X] <code><a class="el" href="interfaceNXNull.html" title="The NXNull class. ">NXNull</a></code> - singleton for null objects that can be inserted into collections</li>
<li>[X] Protocols and <code>conformsTo:</code></li>
<li>[X] Number - <code><a class="el" href="interfaceNXNumber.html" title="The base class for NXNumber instances. ">NXNumber</a></code> with <code>NXNumberInt16</code> and <code>NXNumberUnsignedInt16</code></li>
<li>[X] Number - <code><a class="el" href="interfaceNXNumber.html" title="The base class for NXNumber instances. ">NXNumber</a></code> with <code>NXNumberInt32</code> and <code>NXNumberUnsignedInt32</code></li>
<li>[X] Number - <code><a class="el" href="interfaceNXNumber.html" title="The base class for NXNumber instances. ">NXNumber</a></code> with <code>NXNumberInt64</code> and <code>NXNumberUnsignedInt64</code></li>
<li>[X] Fix linking categories in static libraries (see test NXFoundation_05)</li>
<li>[X] <code><a class="el" href="interfaceNXString.html" title="A class for managing and manipulating string objects. ">NXString</a></code> - mutable strings - append, appendFormat</li>
<li>[X] <code><a class="el" href="interfaceNXArray.html" title="The NXArray class. ">NXArray</a></code> - ordered collections of objects, with methods for adding, removing, and accessing objects</li>
<li>[ ] <code><a class="el" href="interfaceNXString.html" title="A class for managing and manipulating string objects. ">NXString</a></code> - array methods - split, join, etc.</li>
<li>[ ] printf - <code>%@</code> format specifier for logging objects and <code>[<a class="el" href="interfaceObject.html" title="The root class of all Objective-C classes. ">Object</a> description]</code></li>
<li>[ ] printf - <code>f and lf</code> format specifier for floats and doubles</li>
<li>[ ] printf - <code>T</code> format specifier for time intervals</li>
<li>[ ] Number - <code><a class="el" href="interfaceNXNumber.html" title="The base class for NXNumber instances. ">NXNumber</a></code> with <code>NXNumberFloat</code> and <code>NXNumberDouble</code></li>
<li>[ ] <code>NXMap</code> - unordered collections with string-keys (what about <code>NXDictionary</code>?)</li>
<li>[ ] <code><a class="el" href="interfaceNXData.html" title="The NXData class. ">NXData</a></code> - mutable data creating hashes</li>
<li>[ ] <code>make install</code> will compile the libraries and install them to a prefix path</li>
<li>[ ] clang compatibility (probably fix with selectors)</li>
<li>[ ] <code>respondsToSelector:</code> (see test <code>runtime_14</code>)</li>
<li>[ ] More efficient method implementation lookup</li>
<li>[ ] <code>NXCoder</code> - JSON / Binary marshalling and unmarshalling</li>
<li>[ ] <code>NXScanner</code> - scanning and tokenizing</li>
<li>[ ] Calling <code>+[initialise]</code> for categories</li>
<li>[ ] <code><a class="el" href="interfaceNXApplication.html" title="The main application class that coordinates application-wide functionality. ">NXApplication</a></code> and <code>NXRunLoop</code></li>
<li>[ ] Pico toolchain - integrate with Pico SDK</li>
<li>[ ] Threading &amp; <code>@synchronized</code> support</li>
<li>[ ] Exception handling?</li>
</ul>
<h2>References</h2>
<p>Here are some references that may be useful for understanding the Objective C runtime and its implementation:</p>
<ul>
<li><a href="https://github.com/mhjacobson/avr-objc">https://github.com/mhjacobson/avr-objc</a></li>
<li><a href="https://github.com/charlieMonroe/libobjc-kern">https://github.com/charlieMonroe/libobjc-kern</a></li>
<li><a href="https://github.com/gnustep/libobjc">https://github.com/gnustep/libobjc</a> </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
  </ul>
</div>
</body>
</html>
